<html>
    <head>
        <title>KOREK</title>
        <link rel="icon" href="images/koreklogo.jpg">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <style>
        .pdfpng{
            height: 30px;
             width:30px;
            }
    </style>
    </head>
    <body>
<div class="container">
    <div class="row">
        <h3 class="text-center">STUDENT GRADEING SYSTEM</h3>
        
    </div>
<hr>
    <form id="studentGrades">
    <div class="row">
        
        <div class="col-5 offset-3">
            
            <input class="form-control"  name="formFile[]" type="file" id="formFile" multiple accept=".pdf" required>
        <p id="insetMsg"></p>  
        </div>
          <div class="col-3">
            <button type="submit" id="uploadbtn" class="btn btn-primary">
                <i class="fas fa-upload"></i> Upload</button>
              
          </div>
        
        </div>
        </form>
    <a class="btn btn-success btn-sm" href="search.html">Go to Search Page</a>
        <hr>
        <script>
function formreset(){
    $('#studentGrades')[0].reset();
}

        $('#studentGrades').on('submit',function(e){
            $( "#uploadbtn" ).prop( "disabled", true );
//            $( "#formFile" ).prop( "disabled", true );
            
            e.preventDefault();
            $.ajax({
            url: 'http://127.0.0.1:8000/api/upload',
            type: 'POST',
            data: new FormData(this),
            processData: false,
            cache: false,
            contentType: false,
            success: function(isUpload){
//                alert(isUpload);
//        document.write(isUpload); return false;
            if(isUpload > 0){  
                $('#insetMsg').html("<i style='color:green;'>"+isUpload+"  Files Uploaded Successfully.</i>");
                formreset();
                showallfiles();
                $( "#uploadbtn" ).prop( "disabled", false );
             }
            else{ 
                $('#insetMsg').html("<i style='color:red;'>Failed !!</i>");

                }
                         }
                        });
                    });

         
          </script>
    

<div class="row" >
<table class="table" >
   <tbody id="result">
<tr><td><center><i class="fas fa-spinner fa-3x fa-spin" style="color:#4285F4;"></i></center></td></tr>
   </tbody> 
</table>

</div>

</div>

<script>
    
    function showallfiles(){
//        alert(234);
        $("#result").html('');
        $("#result").append("<tr><td><center><i class='fas fa-spinner fa-3x fa-spin' style='color:#4285F4;'></i></center></td></tr>");
        $.ajax({
                url: 'http://127.0.0.1:8000/api/allindexs',
                type: 'POST',
                processData: false,
                cache: false,
                contentType: false,
                success: function(isLoad){
//            document.write(isLoad); return false;

                if(isLoad){
                    // alert(isLoad);
                    var i=1;
                    $("#result").html('');
                    $.each(JSON.parse(isLoad),function(element,index){
                        // console.log(index)
    $("#result").append("<tr><td>"+i+"</td><td><img src='images/pdf.png' class='pdfpng'><a target='_BLANK' href='http://127.0.0.1:8000/api/download/"+index+"' >"+index+" </a></td><td><button class='btn btn-sm btn-danger' onclick='deletePdf("+'"'+index+'"'+")'><i class='fas fa-trash'></i> Delete</button></td></tr>");
    i++; });
                }
            
                
                else{ alert(2); }
         } });
    }

    $(document).ready(function(){showallfiles()});
    
    function deletePdf(index){
        if(confirm("Are You Sure To Delete: "+index)){
                $.ajax({
                url: 'http://127.0.0.1:8000/api/delete/'+index,
                success:function(delpdf){
//            document.write(delpdf); return false;
                if(delpdf){
                    showallfiles();
                }
            
                
                else{ alert(2); }
         } });
    }
    }
    </script>
    </body>
</html>